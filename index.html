<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEURAL CALIBRATION v4.2</title>
    <style>
        * { box-sizing: border-box; touch-action: none; user-select: none; }
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; color: white; }
        
        .overlay-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #0a0a0a; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 500; text-align: center; padding: 20px;
        }

        #loading-overlay { background: black; display: none; z-index: 900; }
        .spinner { 
            width: 40px; height: 40px; border: 4px solid #111; border-top: 4px solid #0f0; 
            border-radius: 50%; animation: spin 0.8s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        button {
            padding: 15px 40px; font-size: 18px; cursor: pointer;
            background: #0f0; color: #000; border: none; font-weight: bold; border-radius: 4px;
        }

        #game-container { display: none; text-align: center; width: 100vw; height: 100vh; }
        #ui-bar { height: 45px; display: flex; justify-content: space-around; align-items: center; background: #111; border-bottom: 1px solid #333; font-family: monospace; }
        canvas { background: #050505; border-bottom: 1px solid #0f0; display: block; margin: 0 auto; }

        .controls { display: grid; grid-template-columns: repeat(3, 1fr); grid-gap: 12px; padding: 20px; max-width: 320px; margin: 0 auto; }
        .btn { height: 60px; background: #111; border: 1px solid #222; display: flex; justify-content: center; align-items: center; border-radius: 12px; font-size: 22px; color: #0f0; }

        #flash-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; display: none; z-index: 1000;
            animation: flash-pulse 0.05s infinite;
        }
        @keyframes flash-pulse { 
            0%, 100% { background: #ffffff; } 50% { background: #cccccc; } 
        }

        #jumpscare-video { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; display: none; z-index: 2000; }
    </style>

    <script>
        let canvas, ctx, sound, flash, video, loading, startOverlay, failOverlay, gameContainer;
        let gameActive = false;
        let player = { x: 20, y: 20, size: 16 };
        
        // SLOWER CHASER SPEED: Set to 0.8
        let enemy = { x: 0, y: 0, size: 16, speed: 0.8 }; 
        
        let exit = { x: 0, y: 0, size: 25 };
        const walls = [
            {x: 60, y: 0, w: 12, h: 200},
            {x: 120, y: 60, w: 180, h: 12},
            {x: 120, y: 60, w: 12, h: 220},
            {x: 230, y: 130, w: 12, h: 150}
        ];

        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            sound = document.getElementById('scream-sound');
            flash = document.getElementById('flash-overlay');
            video = document.getElementById('jumpscare-video');
            loading = document.getElementById('loading-overlay');
            startOverlay = document.getElementById('start-overlay');
            failOverlay = document.getElementById('fail-overlay');
            gameContainer = document.getElementById('game-container');

            canvas.width = Math.min(window.innerWidth - 20, 400);
            canvas.height = 280;
            exit.x = canvas.width - 35;
            exit.y = 15;
        };

        function initGame() {
            startOverlay.style.display = 'none';
            gameContainer.style.display = 'block';
            
            sound.volume = 0;
            sound.play().then(() => {
                sound.pause();
                sound.currentTime = 0;
                sound.volume = 1;
            });
            
            resetPlayer();
        }

        function resetPlayer() {
            player.x = 20; player.y = 20;
            enemy.x = canvas.width - 40; enemy.y = canvas.height - 40;
            failOverlay.style.display = 'none';
            gameActive = true;
            requestAnimationFrame(draw);
        }

        function move(dir) {
            if (!gameActive) return;
            let nx = player.x, ny = player.y, s = 22;
            if (dir === 'up') ny -= s; if (dir === 'down') ny += s;
            if (dir === 'left') nx -= s; if (dir === 'right') nx += s;
            const hitWall = walls.some(w => nx < w.x + w.w && nx + player.size > w.x && ny < w.y + w.h && ny + player.size > w.y);
            const inBounds = nx >= 0 && nx <= canvas.width - player.size && ny >= 0 && ny <= canvas.height - player.size;
            if (!hitWall && inBounds) { player.x = nx; player.y = ny; }
        }

        function draw() {
            if (!gameActive) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = "#222"; walls.forEach(w => ctx.fillRect(w.x, w.y, w.w, w.h));
            ctx.fillStyle = "#0f0"; ctx.fillRect(exit.x, exit.y, exit.size, exit.size);
            ctx.fillStyle = "#ff0"; ctx.fillRect(player.x, player.y, player.size, player.size);
            
            ctx.fillStyle = "#f00";
            if (enemy.x < player.x) enemy.x += enemy.speed; else enemy.x -= enemy.speed;
            if (enemy.y < player.y) enemy.y += enemy.speed; else enemy.y -= enemy.speed;
            ctx.fillRect(enemy.x, enemy.y, enemy.size, enemy.size);

            if (Math.abs(player.x - enemy.x) < 15 && Math.abs(player.y - enemy.y) < 15) {
                gameActive = false; failOverlay.style.display = 'flex'; return;
            }
            if (player.x < exit.x + exit.size && player.x + player.size > exit.x &&
                player.y < exit.y + exit.size && player.y + player.size > exit.y) {
                triggerJumpscare(); return;
            }
            requestAnimationFrame(draw);
        }

        function triggerJumpscare() {
            gameActive = false;
            loading.style.display = 'flex';
            
            setTimeout(() => {
                loading.style.display = 'none';
                
                // FLASHBANG SYNC
                sound.currentTime = 0;
                sound.play();

                setTimeout(() => {
                    flash.style.display = 'block';
                    if ("vibrate" in navigator) {
                        navigator.vibrate([500, 100, 500, 100, 500]);
                    }

                    setTimeout(() => {
                        flash.style.display = 'none';
                        video.style.display = 'block';
                        video.play();
                        if (video.requestFullscreen) video.requestFullscreen();
                        else if (video.webkitEnterFullscreen) video.webkitEnterFullscreen();
                    }, 8000); 

                }, 300); 
                
            }, 1200);
        }

        window.addEventListener('keydown', (e) => {
            if (e.key.includes('Arrow')) move(e.key.replace('Arrow', '').toLowerCase());
        });
    </script>
</head>
<body>

    <div id="start-overlay" class="overlay-screen">
        <h1 style="color: #0f0;">SYSTEM INITIALIZATION</h1>
        <button onclick="initGame()">ACCEPT</button>
    </div>

    <div id="loading-overlay" class="overlay-screen">
        <div class="spinner"></div>
        <h2 style="color: #0f0;">LVL 1 COMPLETE</h2>
    </div>

    <div id="fail-overlay" class="overlay-screen" style="display: none;">
        <h1 style="color: #f00;">SIGNAL LOST</h1>
        <button onclick="resetPlayer()">RE-TRY</button>
    </div>

    <div id="game-container">
        <div id="ui-bar"><span>TERMINAL: 01</span></div>
        <canvas id="gameCanvas"></canvas>
        <div class="controls">
            <div></div><div class="btn" onpointerdown="move('up')">▲</div><div></div>
            <div class="btn" onpointerdown="move('left')">◀</div><div class="btn" onpointerdown="move('down')">▼</div><div class="btn" onpointerdown="move('right')">▶</div>
        </div>
    </div>

    <div id="flash-overlay"></div>
    <video id="jumpscare-video" src="a8b5507f-3eb5-4a74-8041-7d95eb9a99ee.mp4" playsinline></video>
    <audio id="scream-sound" src="Flashbang [LOUD WARNING].mp3" preload="auto"></audio>

</body>
</html>